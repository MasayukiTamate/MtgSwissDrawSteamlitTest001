# プログラム分析レポート

## 概要
本ディレクトリに含まれるPythonプログラムは、MTG（Magic: The Gathering）のスイスドロー形式大会の成績管理を行うStreamlitアプリケーションです。
主に `MtgSwissDrawSteamlit.py`（関数ベースの実装）と `MtgSwissDrawSteamlit002.py`（クラスベースのオブジェクト指向実装）の2つの主要ファイルで構成されています。

## ファイル別分析

### 1. MtgSwissDrawSteamlit.py
**概要**: アプリケーションの初期バージョンと思われるファイル。関数とグローバル変数（リスト、辞書）を中心に構成されています。

#### グローバル変数
| 変数名 | 型 | 説明 |
| :--- | :--- | :--- |
| `playerName` | list | プレイヤー名を格納するリスト。 |
| `playerData` | list[dict] | 各プレイヤーの詳細データ（名前、勝ち点、MP%、OP%、対戦履歴）を格納する辞書のリスト。 |
| `playerNameKari` | list | （未使用の可能性あり）仮のプレイヤー名リスト。 |
| `selected` | object | `option_menu` で選択されたメニュー項目。 |

#### 関数定義
| 関数名 | 引数 | 戻り値 | 詳細説明 |
| :--- | :--- | :--- | :--- |
| `addplayer` | `n` (名前) | None | `playerData` リストに新しいプレイヤー情報の辞書を追加します。初期値として勝ち点0、MP% 0.0、OP% 0.0、空の対戦履歴が設定されます。 |
| `BattleDecision` (未実装) | `pd` | - | 対戦決め用関数のプレースホルダー（コメントアウト状態）。 |
| `BattleBottomDisplay` (未実装) | `s`, `name` | - | 対戦ボタン表示用関数のプレースホルダー。 |
| `BattleDisplay` (未実装) | `battlerLiningUp` | - | 対戦表示用関数のプレースホルダー。 |
| `taisenKime` | `pd` (playerData) | list | `playerData` からプレイヤー名のリスト（対戦ペアリング用）を抽出して返します。現時点では単純なリスト作成のみで、スイスドロー特有のマッチングロジックは未実装のようです。 |
| `taisenBottonHyouji` | `s` (streamlit), `namae` (名前) | `namae` | ストアされたセッション状態(`st.session_state`)を利用して、対戦結果を入力するボタンを表示・処理します。ボタンが押されると勝利カウントを増やします。 |
| `taisenHyouji` | `taisenNarabi` (対戦リスト) | None | 対戦の組み合わせ画面を表示します。リスト順にペアを作り、奇数人の場合は最後のプレイヤーをBYE（不戦勝）として表示します。 |
| `taisenkatimake` | `n` (対戦リスト), `kati` (勝利数リスト) | None | 各プレイヤーの勝利数を表示します。`st.columns` を使用して横並びに配置しています。 |
| `SeisekiHyouji` | `itu` (表示タイミング) | None | 現在の全プレイヤーの成績（名前、勝ち点、MP%、OP%、対戦履歴）を表示します。引数 `itu` は表示タイトルの接頭辞として使用されます。 |

---

### 2. MtgSwissDrawSteamlit002.py
**概要**: `v0.002` と記載されており、オブジェクト指向プログラミング（OOP）を導入して再構築されたバージョンです。「破壊と再生」というコメントがあり、大規模なリファクタリング中と考えられます。

#### クラス定義
このバージョンでは、データと振る舞いがクラスにカプセル化されています。

**1. `PlayerData` クラス**
プレイヤー個人のデータ構造を定義するクラスです。辞書型ではなくオブジェクトとして扱われます。
- **メソッド**:
    - `__init__(self, na)`: コンストラクタ。名前を受け取り初期化します。
- **属性 (Instance Variables)**:
    - `name`: プレイヤー名
    - `winPoint`: 勝ち点
    - `winCountEvery`: 勝利数履歴（リスト）
    - `matchPointPar`: マッチポイント率 (MP%)
    - `opponentPar`: オポネントマッチポイント率 (OP%)
    - `opponentHistory`: 対戦相手の履歴

**2. `SeatData` クラス**
対戦の「席（卓）」情報を管理するクラスです。
- **メソッド**:
    - `__init__(self, pd)`: コンストラクタ。プレイヤーリスト `pd` を受け取り、必要な席数 `CountSeat` を計算します。
- **属性**:
    - `CountSeat`: 計算された席数。奇数人の場合の端数処理も行われています。

**3. `Result` クラス**
成績表示のUIとロジックを担当するクラスです。
- **メソッド**:
    - `__init__(self, no)`: コンストラクタ。試合番号 `no` を受け取ります。
    - `ShowName(self)`: 成績表のヘッダー項目（名前、勝利点など）を表示します。
    - `SetResultData(self, data)`: 成績データを内部リスト `resultData` に追加・整形します。
    - `Show(self)`: カラムを使って整形された成績データを画面に描画します。
- **属性**:
    - `countDuel`: 試合番号
    - `countDuelName`: 試合名（例: "第1試合の成績"）
    - `resultSeatName`: ヘッダー項目リスト
    - `resultData`: 表示用データのリスト
    - `seatcount`: カラム数

#### その他の関数
| 関数名 | 引数 | 戻り値 | 詳細説明 |
| :--- | :--- | :--- | :--- |
| `bou` | `t` (タイプ) | None | 区切り線を表示するユーティリティ関数。`"0"`で細い線、`"1"`で太い線を表示します。 |

#### グローバル変数・処理フロー
- `pData` (list[PlayerData]): `PlayerData` インスタンスのリスト。
- `WinLose` (list): 勝敗記録用のリスト。
- `sData` (SeatData): 席情報オブジェクト。
- `result1st` (Result): 成績表示用オブジェクト。

---

### 3. const.py
**概要**: アプリケーション全体で使用する定数や設定情報を管理するファイルです。
- `SET_PAGE_CONFIG` (dict): `streamlit.set_page_config` に渡す設定値。
- `OPTION_MENU_CONFIG` (dict): `streamlit_option_menu` 用の設定値。
- `HIDE_ST_STYLE` (str): StreamlitのデフォルトUI（ハンバーガーメニュー等）を非表示にするためのCSS。

### 4. introduction.py
**概要**: CSV読み込みとグラフ表示のデモコード。他ファイルとの直接的な依存関係は見当たりません。

## 機能・ユースケース分析

このプログラム（主に `MtgSwissDrawSteamlit.py`）を使用することで、以下のことが行えます。

### 実現できる機能
1.  **プレイヤーエントリー管理**
    *   プレイヤーの人数を「追加」「削除」ボタンで自由に増減できます。
    *   各プレイヤーの名前をテキストボックスで自由に入力・変更できます。
    *   Streamlitのセッション機能により、ブラウザ上での操作中にデータが保持されます。

2.  **簡易的な対戦ペアリング（マッチング）**
    *   登録されたプレイヤーリストに基づき、対戦の組み合わせを自動生成して表示できます。
    *   奇数人の場合、自動的に不戦勝（BYE）枠が設定されます。
    *   *注: 現状はリスト順の単純なペアリングであり、スイスドロー特有の勝ち点に基づくマッチングロジックは未完全です。*

3.  **リアルタイム勝敗入力**
    *   対戦ごとに表示されるボタン（「〇〇が勝った」）をクリックするだけで、勝者を記録できます。
    *   ボタン連打で勝利数をカウントアップする簡易的な仕組みがあります。

4.  **成績・順位の確認**
    *   各プレイヤーの「勝ち点」「対戦履歴」などをリアルタイムで一覧表示できます。
    *   マッチポイント率（MP%）、オポネント・マッチポイント率（OP%）の計算項目が用意されています（ロジック実装は途中）。

### バージョン間の機能差
*   **v1 (MtgSwissDrawSteamlit.py)**:
    *   **動作状況**: 比較的動作するプロトタイプ。
    *   **用途**: 手動操作メインで大会の記録をつける土台として機能します。
*   **v2 (MtgSwissDrawSteamlit002.py)**:
    *   **動作状況**: 開発中（"破壊と再生"）。
    *   **用途**: 将来的な機能拡張（詳細なクラス管理、複雑な成績計算）に向けた構造設計の確認用です。実用可能な大会運営機能はまだハードコード（固定値表示）されている部分が多く、ユーザーが操作して結果を変える部分は限定的です。

### 現状の制限事項（できないこと）
*   **自動ラウンド進行**: 1回戦→2回戦→3回戦と、結果に基づいて自動で次のマッチングを組む完全なフロー機能は未実装です。
*   **データの保存**: ブラウザを閉じるとデータは消えます（データベースやファイルへの保存機能が未連携）。
*   **厳密なスイスドロー計算**: オポネント・マッチ・ウィン・パーセンテージ（OMW%）などの厳密な計算ロジックは枠組みのみで、完全には機能していない可能性があります。

